<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResetRx Platform Architecture</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base'
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a1a1a;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        h2 {
            color: #2c3e50;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            font-size: 24px;
        }
        
        h3 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        p {
            margin-bottom: 15px;
            color: #555;
        }
        
        ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        li {
            margin-bottom: 8px;
            color: #555;
        }
        
        strong {
            color: #2c3e50;
        }
        
        .diagram-container {
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            overflow-x: auto;
        }
        
        .intro {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-left: 4px solid #1565c0;
            border-radius: 4px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ResetRx Platform Architecture</h1>
        
        <div class="intro">
            This document provides an overview of the ResetRx health platform architecture, showing how all components work together to deliver personalized health coaching, lab results, and wellness plans.
        </div>

        <h2>System Architecture Diagram</h2>
        
        <div class="diagram-container">
            <div class="mermaid">
%%{init: {'theme':'base'}}%%
graph TB
    subgraph "Daily Customer Interaction"
        Mobile[Mobile App]
        Dashboard[Dashboard & Health Score]
        Eva[Eva AI Coach]
        Logging[Activity & Food Logging]
        Progress[Progress Tracking]
        NutritionUI[Nutrition Plan View]
        ExerciseUI[Exercise Plan View]
        MindsetUI[Mindset Plan View]
        SleepUI[Sleep Plan View]
        
        Mobile --> Dashboard
        Mobile --> Eva
        Mobile --> Logging
        Mobile --> Progress
        Mobile --> NutritionUI
        Mobile --> ExerciseUI
        Mobile --> MindsetUI
        Mobile --> SleepUI
    end
    
    subgraph "Marketing & Commerce"
        Shopify[Shopify E-commerce]
        Products[Product Catalog]
        Checkout[Checkout & Payment]
        Klaviyo[Klaviyo Marketing]
        EmailFlows[Email Flows & Campaigns]
        
        Shopify --> Products
        Shopify --> Checkout
        Klaviyo --> EmailFlows
    end
    
    subgraph "Core Services - Suggestic Platform"
        GraphQLAPI[GraphQL API]
        UserProfiles[User Profiles & Auth]
        NutritionEngine[Nutrition Plan Engine]
        BiomarkerDB[Biomarker Storage]
        CustomAttributes[Custom Attributes]
        HealthData[Health Data & Metrics]
        Database[(Database)]
        
        GraphQLAPI --> UserProfiles
        GraphQLAPI --> NutritionEngine
        GraphQLAPI --> BiomarkerDB
        GraphQLAPI --> CustomAttributes
        GraphQLAPI --> HealthData
        UserProfiles --> Database
        BiomarkerDB --> Database
        CustomAttributes --> Database
        HealthData --> Database
    end
    
    subgraph "AI Services"
        OpenAI[OpenAI API]
        EvaLogic[Eva Coaching Logic]
        
        OpenAI --> EvaLogic
    end
    
    subgraph "Lab Results Pipeline - Netlify Functions"
        AppointmentSvc[Appointment Management]
        LabResultsSync[Lab Results Sync<br/>Scheduled/On-Demand]
        UserMatching[User Matching by Order Key]
        BiomarkerProcessor[Biomarker Data Processor<br/>Unit Mapping & Alerts]
        NotificationSvc[Notification Service]
        
        AppointmentSvc --> UserMatching
        LabResultsSync --> UserMatching
        LabResultsSync --> BiomarkerProcessor
        BiomarkerProcessor --> NotificationSvc
    end
    
    subgraph "Health Scoring System - Netlify Functions"
        ScoreCalculator[Score Calculator]
        WeightMetrics[Weight Tracking]
        SleepMetrics[Sleep Quality]
        MovementMetrics[Movement/Exercise]
        MindfulnessMetrics[Mindfulness]
        NutritionMetrics[Nutrition Adherence]
        
        ScoreCalculator --> WeightMetrics
        ScoreCalculator --> SleepMetrics
        ScoreCalculator --> MovementMetrics
        ScoreCalculator --> MindfulnessMetrics
        ScoreCalculator --> NutritionMetrics
    end
    
    subgraph "Plan Generation - Netlify Functions"
        ExercisePlanGen[Exercise Plan Generator]
        MindsetPlanGen[Mindset Plan Generator]
        SleepPlanGen[Sleep Plan Generator]
    end
    
    subgraph "External APIs"
        KHSS[KHSS/Quest Diagnostics]
        LabOrders[Lab Order Submission]
        LabResults[Test Results Retrieval]
        
        KHSS --> LabOrders
        KHSS --> LabResults
    end

    %% Daily Interaction Connections
    Dashboard --> ScoreCalculator
    Eva --> EvaLogic
    Logging --> HealthData
    Progress --> HealthData
    NutritionUI --> NutritionEngine
    ExerciseUI --> ExercisePlanGen
    MindsetUI --> MindsetPlanGen
    SleepUI --> SleepPlanGen
    Mobile --> AppointmentSvc
    
    %% Commerce Connections
    Shopify -.->|New User Webhook| UserProfiles
    Shopify -.->|Customer Sync| Klaviyo
    
    %% Lab Results Pipeline Flow
    AppointmentSvc --> KHSS
    AppointmentSvc --> CustomAttributes
    LabResultsSync --> KHSS
    UserMatching --> CustomAttributes
    BiomarkerProcessor --> BiomarkerDB
    NotificationSvc --> Klaviyo
    
    %% Health Scoring Connections
    ScoreCalculator --> HealthData
    ScoreCalculator --> BiomarkerDB
    
    %% Plan Generation Connections
    ExercisePlanGen --> HealthData
    MindsetPlanGen --> HealthData
    SleepPlanGen --> HealthData
    
    %% Core API Gateway
    Dashboard --> GraphQLAPI
    Logging --> GraphQLAPI
    Progress --> GraphQLAPI
    NutritionUI --> GraphQLAPI

    classDef customer fill:#e3f2fd,stroke:#1565c0,stroke-width:3px
    classDef commerce fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef core fill:#e8f5e9,stroke:#2e7d32,stroke-width:3px
    classDef ai fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef labPipeline fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    classDef scoring fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    classDef planGen fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef external fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class Mobile,Dashboard,Eva,Logging,Progress,NutritionUI,ExerciseUI,MindsetUI,SleepUI customer
    class Shopify,Products,Checkout,Klaviyo,EmailFlows commerce
    class GraphQLAPI,UserProfiles,NutritionEngine,BiomarkerDB,CustomAttributes,HealthData,Database core
    class OpenAI,EvaLogic ai
    class AppointmentSvc,LabResultsSync,UserMatching,BiomarkerProcessor,NotificationSvc labPipeline
    class ScoreCalculator,WeightMetrics,SleepMetrics,MovementMetrics,MindfulnessMetrics,NutritionMetrics scoring
    class ExercisePlanGen,MindsetPlanGen,SleepPlanGen planGen
    class KHSS,LabOrders,LabResults external
            </div>
        </div>

        <div class="section">
            <h2>Component Overview</h2>

            <h3>Daily Customer Interaction</h3>
            <p>The mobile app provides the primary user interface for all health management activities:</p>
            <ul>
                <li><strong>Dashboard</strong> - Health score visualization and progress overview</li>
                <li><strong>Eva AI Coach</strong> - Conversational AI health coaching powered by OpenAI</li>
                <li><strong>Activity & Food Logging</strong> - Track daily nutrition and exercise</li>
                <li><strong>Progress Tracking</strong> - View trends and achievements</li>
                <li><strong>Health Plans</strong> - Access personalized nutrition, exercise, mindset, and sleep plans</li>
            </ul>

            <h3>Marketing & Commerce</h3>
            <ul>
                <li><strong>Shopify</strong> - E-commerce platform for product sales and subscriptions</li>
                <li><strong>Klaviyo</strong> - Marketing automation for email campaigns and user engagement</li>
            </ul>

            <h3>Core Services - Suggestic Platform</h3>
            <p>Central data platform providing:</p>
            <ul>
                <li><strong>GraphQL API</strong> - Primary API gateway for mobile app</li>
                <li><strong>User Profiles</strong> - Authentication and user management</li>
                <li><strong>Nutrition Engine</strong> - AI-powered nutrition planning</li>
                <li><strong>Biomarker Storage</strong> - Lab test results and health metrics</li>
                <li><strong>Custom Attributes</strong> - Flexible user metadata storage</li>
                <li><strong>Health Data</strong> - Activity, weight, sleep, and other health metrics</li>
            </ul>

            <h3>AI Services</h3>
            <ul>
                <li><strong>OpenAI</strong> - Powers Eva AI coach with natural language understanding</li>
                <li><strong>Eva Logic</strong> - Custom coaching algorithms and conversation flows</li>
            </ul>

            <h3>Lab Results Pipeline (Custom Integration)</h3>
            <p>Serverless functions handling Quest Diagnostics integration:</p>
            <ul>
                <li><strong>Appointment Management</strong> - Book lab appointments</li>
                <li><strong>Lab Results Sync</strong> - Scheduled retrieval of test results from KHSS</li>
                <li><strong>User Matching</strong> - Match lab orders to users via appointment data</li>
                <li><strong>Biomarker Processor</strong> - Transform and validate biomarker data with unit mapping</li>
                <li><strong>Notification Service</strong> - Klaviyo notifications for appointments and results</li>
            </ul>

            <h3>Health Scoring System (Custom Analytics)</h3>
            <p>Multi-dimensional health scoring:</p>
            <ul>
                <li><strong>Score Calculator</strong> - Aggregates metrics into overall health score</li>
                <li><strong>Component Metrics</strong> - Weight, sleep, movement, mindfulness, nutrition tracking</li>
            </ul>

            <h3>Plan Generation (Custom Content)</h3>
            <p>Automated plan creation:</p>
            <ul>
                <li><strong>Exercise Plans</strong> - Personalized workout routines</li>
                <li><strong>Mindset Plans</strong> - Mental health and stress management</li>
                <li><strong>Sleep Plans</strong> - Sleep optimization strategies</li>
            </ul>

            <h3>External APIs</h3>
            <ul>
                <li><strong>KHSS/Quest Diagnostics</strong> - Lab order submission and result retrieval</li>
            </ul>
        </div>

        <div class="section">
            <h2>Data Flows</h2>

            <h3>User Onboarding</h3>
            <ol>
                <li>Customer purchases on Shopify</li>
                <li>Shopify webhook creates user in Suggestic</li>
                <li>Customer synced to Klaviyo for marketing</li>
                <li>User receives welcome email and app access</li>
            </ol>

            <h3>Lab Testing Journey</h3>
            <ol>
                <li>User books appointment via mobile app</li>
                <li>Appointment saved to KHSS/Quest and Suggestic custom attributes</li>
                <li>User receives appointment confirmation via Klaviyo</li>
                <li>Lab results retrieved via scheduled sync</li>
                <li>Results matched to user via appointment order key</li>
                <li>Biomarkers stored in Suggestic with alerts</li>
                <li>User notified via Klaviyo email</li>
                <li>Results visible in mobile app</li>
            </ol>

            <h3>Daily Usage</h3>
            <ol>
                <li>User logs activity and food in mobile app</li>
                <li>Data stored in Suggestic via GraphQL API</li>
                <li>Health score recalculated based on metrics</li>
                <li>Eva provides coaching based on progress</li>
                <li>Plans updated based on adherence and goals</li>
            </ol>
        </div>

        <div class="section">
            <h2>Technology Stack</h2>
            <ul>
                <li><strong>Frontend:</strong> Mobile App (iOS/Android)</li>
                <li><strong>Backend:</strong> Netlify Functions (Serverless)</li>
                <li><strong>APIs:</strong> Suggestic GraphQL, KHSS/Quest, OpenAI, Klaviyo</li>
                <li><strong>Database:</strong> Managed by Suggestic</li>
                <li><strong>Commerce:</strong> Shopify</li>
                <li><strong>Marketing:</strong> Klaviyo</li>
                <li><strong>AI:</strong> OpenAI GPT models</li>
            </ul>
        </div>

        <div class="section">
            <h2>Security & Privacy</h2>
            <ul>
                <li>User authentication managed by Suggestic</li>
                <li>PHI data minimized in Klaviyo notifications (counts only, no biomarker names)</li>
                <li>HIPAA-compliant lab integration via KHSS</li>
                <li>Encrypted data transmission across all services</li>
            </ul>
        </div>
    </div>
</body>
</html>
